<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<body>


<div th:fragment="member-breadcrumb">
    <ol class="breadcrumb bc-3">
        <li>
            <a th:href="@{/stl-admin}"><i class="entypo-home"></i>Dashboard</a>
        </li>
        <li>
            <a th:href="@{/stl-admin/user/all}">User</a>
        </li>
        <li class="active">
            <strong>Edit</strong>
        </li>
    </ol>
    <div class="col-md-6">
        <h2>
            <strong th:if="${tab == null || tab == 'general'}" th:text="#{admin.member.tab.general.text}"></strong>
            <strong th:if="${tab == 'password'}" th:text="#{admin.member.tab.password.text}"></strong>
            <strong th:if="${tab == 'doc'}" th:text="#{admin.member.tab.doc.text}"></strong>
        </h2>
    </div>
    <!-- include button tool -->
    <div th:include="admin/user/script::detail-tool"></div>
    <div class="clearfix"></div>
</div>
<div th:fragment="detail-tab">
    <div class="panel-options">
        <ul class="nav nav-tabs">
            <li th:class="${(tab == 'general' || tab ==null) ? 'active' : ''}">
                <a th:href="@{/stl-admin/user/edit/{id}(id=${userId},tab=general)}"
                   th:text="#{admin.member.tab.general.text}">General</a></li>
            <li th:class="${(tab == 'password') ? 'active' : ''}">
                <a th:href="@{/stl-admin/user/edit/{id}(id=${userId},tab=password)}"
                   th:text="#{admin.member.tab.password.text}">Password</a></li>
            <li th:class="${(tab == 'doc') ? 'active' : ''}">
                <a th:href="@{/stl-admin/user/edit/{id}(id=${userId},tab=doc)}"
                   th:text="#{admin.member.tab.doc.text}">Document</a></li>
            <li th:class="${(tab == 'role') ? 'active' : ''}">
                <a th:href="@{/stl-admin/user/edit/{id}(id=${userId},tab=role)}"
                   th:text="#{admin.user.tab.role.text}">Role </a></li>
        </ul>
    </div>
</div>
<div th:fragment="detail-tool">
    <div class="col-md-12">
        <div class="form-group align-right" id="toolBar">

        </div>
    </div>
</div>
<div th:fragment="member-toolbar">
    <script th:inline="javascript" type="application/javascript">
        //<![CDATA[
        jQuery(document).ready(function ($) {
            var urlActiveMember = /*[[@{/api/user/active/{userId}/{byUserId}(userId=${userId}, byUserId=${#authorization.getAuthentication().getPrincipal().id})}]]*/;
            var urlLockMember = /*[[@{/api/user/change-status/false/{userId}/{byUserId}(userId=${userId}, byUserId=${#authorization.getAuthentication().getPrincipal().id})}]]*/;
            var urlUnLockMember = /*[[@{/api/user/change-status/true/{userId}/{byUserId}(userId=${userId}, byUserId=${#authorization.getAuthentication().getPrincipal().id})}]]*/;
            var activeConfirm = /*[[#{admin.member.active.confirm.text}]]*/;
            var lockConfirm = /*[[#{admin.member.lock.confirm.text}]]*/;

            $(document).on('click', '#btnActiveMember', function () {
                if (confirm(activeConfirm)) {
                    getData(urlActiveMember, reloadPage, showErrors);
                }
            });

            $(document).on('click', '#btnLockMember', function () {
                if (confirm(lockConfirm)) {
                    getData(urlLockMember, reloadPage, showErrors);
                }
            });

            $(document).on('click', '#btnUnLockMember', function () {
                if (confirm(lockConfirm)) {
                    getData(urlUnLockMember, reloadPage, showErrors);
                }
            });

            if(userData != null)
                toolBarMember(userData);

            function reloadPage(data) {
                window.location.reload();
            }
        });

        /**
         * Build toolbar
         * @param data
         */
        function toolBarMember(data) {
            var activeMemberText = /*[[#{admin.member.button.active.text}]]*/;
            var enabledMemberText = /*[[#{admin.member.enabled.text}]]*/;
            var disabledMemberText = /*[[#{admin.member.disabled.text}]]*/;
            var strBtn = '';
            if (!data.actived)
                strBtn += '<button type="button" id="btnActiveMember" class="btn btn-success"> ' + activeMemberText + '</button>';

            if (data.enabled)
                strBtn += '<button type="button" id="btnLockMember" class="btn btn-danger" ' +
                    '>' + enabledMemberText + '</button>';
            else
                strBtn += '<button type="button" id="btnUnLockMember" class="btn btn-success" ' +
                    '>' + disabledMemberText + ' </button>';

            $('#toolBar').append(strBtn);
        }
        //]]>
    </script>
</div>
<div th:fragment="member-load-data">
    <script th:inline="javascript" type="text/javascript">
        var userData = null;
        var userId = /*[[${#authorization.getAuthentication().getPrincipal().id}]]*/;
        var id = /*[[${userId}]]*/;
        jQuery(document).ready(function ($) {

            if (id != null) {
                var urlGetData = /*[[@{/api/staff/{userId}(userId=${userId})}]]*/;
                $.getData(urlGetData, assignData, showMemberErrors);
            }
        });

        function assignData(data) {
            userData = data;
        }

        function showMemberErrors(data) {
            showErrors(data);
            $('.mainContent').html('');
        }



    </script>
    <!-- include button tool -->
    <div th:include="admin/user/script::member-toolbar"></div>
</div>
</body>
</html>